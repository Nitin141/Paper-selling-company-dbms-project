<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Forgot password</title>
    <link rel="stylesheet" href="/public/shared.css" />
    <style>
      #message {
        width: 250px;
      }
    </style>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
      integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
      crossorigin="anonymous"
    />
  </head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <body>
    <div class="body"></div>
    <div class="grad"></div>
    <div class="header">
      <div>Paper<span>Go</span></div>
    </div>
    <br />
    <div class="login">
      <form method="POST" id="Forgot" name="Forgot">
        <label for="username"></label
        ><input
          type="text"
          name="username"
          id="username"
          placeholder="Enter your employee id"
        />
        <label for="password"></label
        ><input
          type="password"
          name="password"
          id="password"
          placeholder="Enter new password"
        />
        <label for="cpassword"></label
        ><input
          type="password"
          name="cpassword"
          id="cpassword"
          placeholder="Confirm your password"
        />

        <div>
          <button type="submit" id="btn" value="Add new user">
            Send request to admin
          </button>
        </div>
      </form>
      <div id="message"></div>
      <div id="Error"></div>
    </div>
  </body>
  <script>
    $.fn.serializeObject = function () {
      var o = {}
      var a = this.serializeArray()
      $.each(a, function () {
        if (o[this.name] !== undefined) {
          if (!o[this.name].push) {
            o[this.name] = [o[this.name]]
          }
          o[this.name].push(this.value || '')
        } else {
          o[this.name] = this.value || ''
        }
      })
      return o
    }
    let forgot = document.getElementById('Forgot')
    forgot.addEventListener('submit', (e) => {
      e.preventDefault()
      var newData = JSON.stringify($('#Forgot').serializeObject())
      let empid = document.forms['Forgot']['username'].value
      let password = document.forms['Forgot']['password'].value
      let cpassword = document.forms['Forgot']['cpassword'].value
      if (password === cpassword && empid != '' && password != '') {
        $.ajax({
          type: 'POST',
          url: 'http://localhost:4000/newpass',
          data: newData,
          success: function () {
            entries = JSON.parse(localStorage.getItem('allentry'))
            if (entries == null) {
              entries = []
            }
            entry = {
              username: empid,
              password: password,
            }
            entries.push(entry)
            localStorage.setItem('allentry', JSON.stringify(entries))
            let message = document.getElementById('message')
            message.innerHTML = `<div class="alert alert-success" role="alert">
          Request sent to admin
      </div>`
            setTimeout(() => {
              message.innerHTML = ''
            }, 2000)
            document.getElementById('username').value = ''
            document.getElementById('password').value = ''
            document.getElementById('cpassword').value = ''
            window.location.href = '/loginp'
          },
          error: function () {
            let message = document.getElementById('message')
            message.innerHTML = `<div class="alert alert-danger" role="alert">
          Incorrect employee id
      </div>`
            setTimeout(() => {
              message.innerHTML = ''
            }, 2000)
          },
          dataType: 'json',
          contentType: 'application/json',
        })
      } else {
        let message = document.getElementById('message')
        message.innerHTML = `<div class="alert alert-danger" role="alert">
          Password must be same in both fields
      </div>`
        setTimeout(() => {
          message.innerHTML = ''
        }, 2000)
      }
    })
  </script>
</html>
